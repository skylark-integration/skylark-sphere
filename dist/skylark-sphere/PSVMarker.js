/**
 * skylark-sphere - A version of sphere that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sphere/
 * @license MIT
 */
define(["./PSVError","./PSVAnimation","./PSVUtils"],function(t,e,i){"use strict";function s(e,h){if(!e.id)throw new t("missing marker id");if(e.image&&(!e.width||!e.height))throw new t("missing marker width/height");if((e.image||e.html)&&!(e.hasOwnProperty("x")&&e.hasOwnProperty("y")||e.hasOwnProperty("latitude")&&e.hasOwnProperty("longitude")))throw new t("missing marker position, latitude/longitude or x/y");this.psv=h,this.visible=!0,this._dynamicSize=!1;var r,n=e.id,o=s.getType(e,!1);Object.defineProperties(this,{id:{configurable:!1,enumerable:!0,get:function(){return n},set:function(){}},type:{configurable:!1,enumerable:!0,get:function(){return o},set:function(){}},$el:{configurable:!1,enumerable:!0,get:function(){return r},set:function(){}},_def:{configurable:!1,enumerable:!0,get:function(){return this[o]},set:function(t){this[o]=t}}}),(r=this.isNormal()?document.createElement("div"):this.isPolygon()?document.createElementNS(i.svgNS,"polygon"):this.isPolyline()?document.createElementNS(i.svgNS,"polyline"):document.createElementNS(i.svgNS,this.type)).id="psv-marker-"+this.id,r.psvMarker=this,this.update(e)}return s.types=["image","html","polygon_px","polygon_rad","polyline_px","polyline_rad","rect","circle","ellipse","path"],s.getType=function(e,i){var h=[];if(s.types.forEach(function(t){e[t]&&h.push(t)}),0===h.length&&!i)throw new t("missing marker content, either "+s.types.join(", "));if(h.length>1)throw new t("multiple marker content, either "+s.types.join(", "));return h[0]},s.prototype.destroy=function(){delete this.$el.psvMarker},s.prototype.isNormal=function(){return"image"===this.type||"html"===this.type},s.prototype.isPoly=function(){return this.isPolygon()||this.isPolyline()},s.prototype.isPolygon=function(){return"polygon_px"===this.type||"polygon_rad"===this.type},s.prototype.isPolyline=function(){return"polyline_px"===this.type||"polyline_rad"===this.type},s.prototype.isSvg=function(){return"rect"===this.type||"circle"===this.type||"ellipse"===this.type||"path"===this.type},s.prototype.getScale=function(t){return Array.isArray(this.scale)?this.scale[0]+(this.scale[1]-this.scale[0])*e.easings.inQuad(t/100):"function"==typeof this.scale?this.scale(t):"number"==typeof this.scale?this.scale*e.easings.inQuad(t/100):1},s.prototype.update=function(e){if(e&&e!==this){var h=s.getType(e,!0);if(void 0!==h&&h!==this.type)throw new t("cannot change marker type");i.deepmerge(this,e)}this.isNormal()?this.$el.setAttribute("class","psv-marker psv-marker--normal"):this.$el.setAttribute("class","psv-marker psv-marker--svg"),this.className&&i.addClasses(this.$el,this.className),this.tooltip&&(i.addClasses(this.$el,"has-tooltip"),"string"==typeof this.tooltip&&(this.tooltip={content:this.tooltip})),this.style&&i.deepmerge(this.$el.style,this.style),this.anchor=i.parsePosition(this.anchor),this.isNormal()?this._updateNormal():this.isPolygon()?this._updatePoly("polygon_rad","polygon_px"):this.isPolyline()?this._updatePoly("polyline_rad","polyline_px"):this._updateSvg()},s.prototype._updateNormal=function(){this.width&&this.height?(this.$el.style.width=this.width+"px",this.$el.style.height=this.height+"px",this._dynamicSize=!1):this._dynamicSize=!0,this.image?this.$el.style.backgroundImage="url("+this.image+")":this.$el.innerHTML=this.html,this.$el.style.transformOrigin=100*this.anchor.left+"% "+100*this.anchor.top+"%",this.psv.cleanPosition(this),this.position3D=this.psv.sphericalCoordsToVector3(this)},s.prototype._updateSvg=function(){switch(this._dynamicSize=!0,this.type){case"rect":"number"==typeof this._def?this._def={x:0,y:0,width:this._def,height:this._def}:Array.isArray(this._def)?this._def={x:0,y:0,width:this._def[0],height:this._def[1]}:this._def.x=this._def.y=0;break;case"circle":"number"==typeof this._def?this._def={cx:this._def,cy:this._def,r:this._def}:Array.isArray(this._def)?this._def={cx:this._def[0],cy:this._def[0],r:this._def[0]}:this._def.cx=this._def.cy=this._def.r;break;case"ellipse":"number"==typeof this._def?this._def={cx:this._def,cy:this._def,rx:this._def,ry:this._def}:Array.isArray(this._def)?this._def={cx:this._def[0],cy:this._def[1],rx:this._def[0],ry:this._def[1]}:(this._def.cx=this._def.rx,this._def.cy=this._def.ry);break;case"path":"string"==typeof this._def&&(this._def={d:this._def})}Object.getOwnPropertyNames(this._def).forEach(function(t){this.$el.setAttributeNS(null,t,this._def[t])},this),this.svgStyle?Object.getOwnPropertyNames(this.svgStyle).forEach(function(t){this.$el.setAttributeNS(null,i.dasherize(t),this.svgStyle[t])},this):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.psv.cleanPosition(this),this.position3D=this.psv.sphericalCoordsToVector3(this)},s.prototype._updatePoly=function(t,e){this._dynamicSize=!0,this.svgStyle?(Object.getOwnPropertyNames(this.svgStyle).forEach(function(t){this.$el.setAttributeNS(null,i.dasherize(t),this.svgStyle[t])},this),this.isPolyline()&&!this.svgStyle.fill&&this.$el.setAttributeNS(null,"fill","none")):this.isPolygon()?this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline()&&(this.$el.setAttributeNS(null,"fill","none"),this.$el.setAttributeNS(null,"stroke","rgb(0,0,0)")),[this[t],this[e]].forEach(function(t){if(t&&"object"!=typeof t[0])for(var e=0;e<t.length;e++)t.splice(e,2,[t[e],t[e+1]])}),this[e]?this[t]=this[e].map(function(t){var e=this.psv.textureCoordsToSphericalCoords({x:t[0],y:t[1]});return[e.longitude,e.latitude]},this):this[t]=this[t].map(function(t){return[i.parseAngle(t[0]),i.parseAngle(t[1],!0)]}),this.longitude=this[t][0][0],this.latitude=this[t][0][1],this.positions3D=this[t].map(function(t){return this.psv.sphericalCoordsToVector3({longitude:t[0],latitude:t[1]})},this)},s});
//# sourceMappingURL=sourcemaps/PSVMarker.js.map
