/**
 * skylark-sphere - A version of sphere that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sphere/
 * @license MIT
 */
define(["skylark-threejs","./ctoc","../PSVUtils","../PSVError"],function(t,e,o,i){"use strict";return e._loadSystem=function(){var t=e.SYSTEM;t.loaded=!0,t.pixelRatio=window.devicePixelRatio||1,t.isWebGLSupported=o.isWebGLSupported(),t.isCanvasSupported=o.isCanvasSupported(),t.maxTextureWidth=t.isWebGLSupported?o.getMaxTextureWidth():4096,t.mouseWheelEvent=o.mouseWheelEvent(),t.fullscreenEvent=o.fullscreenEvent(),t.deviceOrientationSupported=o.isDeviceOrientationSupported(),t.touchEnabled=o.isTouchEnabled()},e.prototype._setViewerSize=function(t){["width","height"].forEach(function(e){t[e]&&(/^[0-9.]+$/.test(t[e])&&(t[e]+="px"),this.parent.style[e]=t[e])},this)},e.prototype.speedToDuration=function(t,e){if(t&&"number"==typeof t)return Math.abs(t);var i=t?o.parseSpeed(t):this.config.anim_speed;return e/Math.abs(i)*1e3},e.prototype.textureCoordsToSphericalCoords=function(t){if(this.prop.isCubemap)throw new i("Unable to use texture coords with cubemap.");var e=(t.x+this.prop.pano_data.cropped_x)/this.prop.pano_data.full_width*o.TwoPI,r=(t.y+this.prop.pano_data.cropped_y)/this.prop.pano_data.full_height*Math.PI;return{longitude:e>=Math.PI?e-Math.PI:e+Math.PI,latitude:o.HalfPI-r}},e.prototype.sphericalCoordsToTextureCoords=function(t){if(this.prop.isCubemap)throw new i("Unable to use texture coords with cubemap.");var e=t.longitude/o.TwoPI*this.prop.pano_data.full_width,r=t.latitude/Math.PI*this.prop.pano_data.full_height;return{x:parseInt(t.longitude<Math.PI?e+this.prop.pano_data.full_width/2:e-this.prop.pano_data.full_width/2)-this.prop.pano_data.cropped_x,y:parseInt(this.prop.pano_data.full_height/2-r)-this.prop.pano_data.cropped_y}},e.prototype.sphericalCoordsToVector3=function(o){return new t.Vector3(e.SPHERE_RADIUS*-Math.cos(o.latitude)*Math.sin(o.longitude),e.SPHERE_RADIUS*Math.sin(o.latitude),e.SPHERE_RADIUS*Math.cos(o.latitude)*Math.cos(o.longitude))},e.prototype.vector3ToSphericalCoords=function(t){var e=Math.acos(t.y/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)),i=Math.atan2(t.x,t.z);return{longitude:i<0?-i:o.TwoPI-i,latitude:o.HalfPI-e}},e.prototype.viewerCoordsToVector3=function(e){var o=new t.Vector2(2*e.x/this.prop.size.width-1,-2*e.y/this.prop.size.height+1);this.raycaster.setFromCamera(o,this.camera);var i=this.raycaster.intersectObjects(this.scene.children);return 1===i.length?i[0].point:null},e.prototype.vector3ToViewerCoords=function(t){return(t=t.clone()).project(this.camera),{x:parseInt((t.x+1)/2*this.prop.size.width),y:parseInt((1-t.y)/2*this.prop.size.height)}},e.prototype.cleanPosition=function(t){t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&o.deepmerge(t,this.textureCoordsToSphericalCoords(t)),t.longitude=o.parseAngle(t.longitude),t.latitude=o.parseAngle(t.latitude,!0)},e.prototype.cleanSphereCorrection=function(t){t.pan=o.parseAngle(t.pan||0),t.tilt=o.parseAngle(t.tilt||0,!0),t.roll=o.parseAngle(t.roll||0,!0,!1)},e.prototype.isExtendedPosition=function(t){return[["x","y"],["longitude","latitude"]].some(function(e){return e[0]in t&&e[1]in t})},e.prototype.applyRanges=function(e){var i,r,a=[];return this.config.longitude_range&&(i=o.clone(this.config.longitude_range),r=t.Math.degToRad(this.prop.hFov)/2,i[0]=o.parseAngle(i[0]+r),i[1]=o.parseAngle(i[1]-r),i[0]>i[1]?e.longitude>i[1]&&e.longitude<i[0]&&(e.longitude>i[0]/2+i[1]/2?(e.longitude=i[0],a.push("left")):(e.longitude=i[1],a.push("right"))):e.longitude<i[0]?(e.longitude=i[0],a.push("left")):e.longitude>i[1]&&(e.longitude=i[1],a.push("right"))),this.config.latitude_range&&(i=o.clone(this.config.latitude_range),r=t.Math.degToRad(this.prop.vFov)/2,i[0]=o.parseAngle(Math.min(i[0]+r,i[1]),!0),i[1]=o.parseAngle(Math.max(i[1]-r,i[0]),!0),e.latitude<i[0]?(e.latitude=i[0],a.push("bottom")):e.latitude>i[1]&&(e.latitude=i[1],a.push("top"))),a},e});
//# sourceMappingURL=../sourcemaps/_psv/utils.js.map
